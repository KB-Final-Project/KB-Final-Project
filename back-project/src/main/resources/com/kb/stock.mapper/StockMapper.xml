<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kb.stock.mapper.StockMapper">

    <select id="selectAllStockCodes" resultType="String">
        SELECT stock_code FROM stock_codes
    </select>


    <insert id="upsertStock" parameterType="com.kb.stock.dto.StockDTO">
        INSERT INTO stock (stock_code, stock_name, current_price, price_change, price_change_pct, high_price, low_price, opening_price, volume, industry, last_updated)
        VALUES (#{stockCode}, #{stockName}, #{currentPrice}, #{priceChange}, #{priceChangePct}, #{highPrice}, #{lowPrice}, #{openingPrice}, #{volume}, #{bstpKorIsnm}, NOW())
            ON DUPLICATE KEY UPDATE
                                 stock_name = #{stockName},
                                 current_price = #{currentPrice},
                                 price_change = #{priceChange},
                                 price_change_pct = #{priceChangePct},
                                 high_price = #{highPrice},
                                 low_price = #{lowPrice},
                                 opening_price = #{openingPrice},
                                 volume = #{volume},
                                 industry = #{bstpKorIsnm},
                                 last_updated = NOW();
    </insert>


    <select id="selectStockNameByCode" parameterType="String" resultType="String">
        SELECT sc.stock_name
        FROM stock_codes sc
        WHERE sc.stock_code = #{stockCode}
    </select>


</mapper>
